{"name":"Type Checker","type":"script","author":"Pc5KoEtD3AcIhK1c","img":"worlds/prpg/Pokemon/item_icons/80px-FairyIC_NPSnap.png","scope":"global","command":"const content = `\n<form>\n    <fieldset>\n        <legend>Pokemon Type Calculator</legend>\n<div>\n\n            <label> Move Type </label>\n            <select id=\"attacktype\" name=\"attacktype\">\n                <option value=\"Normal\">Normal</option>\n                <option value=\"Fighting\">Fighting</option>\n                <option value=\"Flying\">Flying</option>\n<option value=\"Poison\">Poison</option>\n<option value=\"Ground\">Ground</option>\n<option value=\"Rock\">Rock</option>\n<option value=\"Bug\">Bug</option>\n<option value=\"Ghost\">Ghost</option>\n<option value=\"Steel\">Steel</option>\n<option value=\"Fire\">Fire</option>\n<option value=\"Water\">Water</option>\n<option value=\"Grass\">Grass</option>\n<option value=\"Electric\">Electric</option>\n<option value=\"Psychic\">Psychic</option>\n<option value=\"Ice\">Ice</option>\n<option value=\"Dragon\">Dragon</option>\n<option value=\"Dark\">Dark</option>\n<option value=\"Fairy\">Fairy</option>\n</select>\n</div>\n<div>\n            <label> Target Pokemon Type</label>\n            <select id=\"enemytype1\" name=\"enemytype1\">\n                <option value=0>Normal</option>\n                <option value=1>Fighting</option>\n                <option value=2>Flying</option>\n<option value=3>Poison</option>\n<option value=4>Ground</option>\n<option value=5>Rock</option>\n<option value=6>Bug</option>\n<option value=7>Ghost</option>\n<option value=8>Steel</option>\n<option value=9>Fire</option>\n<option value=10>Water</option>\n<option value=11>Grass</option>\n<option value=12>Electric</option>\n<option value=13>Psychic</option>\n<option value=14>Ice</option>\n<option value=15>Dragon</option>\n<option value=16>Dark</option>\n<option value=17>Fairy</option>\n            </select>\n <select id=\"enemytype2\" name=\"enemytype2\">\n                <option value=\"None\">None</option>\n                <option value=0>Normal</option>\n                <option value=1>Fighting</option>\n                <option value=2>Flying</option>\n<option value=3>Poison</option>\n<option value=4>Ground</option>\n<option value=5>Rock</option>\n<option value=6>Bug</option>\n<option value=7>Ghost</option>\n<option value=8>Steel</option>\n<option value=9>Fire</option>\n<option value=10>Water</option>\n<option value=11>Grass</option>\n<option value=12>Electric</option>\n<option value=13>Psychic</option>\n<option value=14>Ice</option>\n<option value=15>Dragon</option>\n<option value=16>Dark</option>\n<option value=17>Fairy</option>\n            </select>\n\n\n        \n</div>\n\n    </fieldset>\n</form>`;\nconst callback = async (html) => {\n var typing = [\"Normal\", \"Fighting\", \"Flying\", \"Poison\", \"Ground\", \"Rock\", \"Bug\", \"Ghost\", \"Steel\", \"Fire\", \"Water\", \"Grass\", \"Electric\", \"Psychic\", \"Ice\", \"Dragon\", \"Dark\", \"Fairy\"]\nvar NormalEffectiveness = [1, 1, 1, 1, 1, 0.5, 1, 0, 0.5, 1, 1, 1, 1, 1, 1, 1, 1, 1];\nvar FightingEffectiveness = [2, 1, 0.5, 0.5, 1, 2, 0.5, 0, 2, 1, 1, 1, 1, 0.5, 2, 1, 2, 0.5];\nvar FlyingEffectiveness = [1, 2, 1, 1, 1, 0.5, 2, 1, 0.5, 1, 1, 2, 0.5, 1, 1, 1, 1, 1];\nvar PoisonEffectiveness = [1, 1, 1, 0.5, 0.5, 0.5, 1, 0.5, 0, 1, 1, 2, 1, 1, 1, 1, 1, 2];\nvar GroundEffectiveness = [1, 1, 0, 2, 1, 2, 0.5, 1, 2, 2, 1, 0.5, 2, 1, 1, 1, 1, 1];\nvar RockEffectiveness = [1, 0.5, 2, 1, 0.5, 1, 2, 1, 0.5, 2, 1, 1, 1, 1, 2, 1, 1, 1];\nvar BugEffectiveness = [1, 0.5, 0.5, 0.5, 1, 1, 1, 0.5, 0.5, 0.5, 1, 2, 1, 2, 1, 1, 2, 0.5];\nvar GhostEffectiveness = [0, 1, 1, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1, 2, 1, 1, 0.5, 1];\nvar SteelEffectiveness = [1, 1, 1, 1, 1, 2, 1, 1, 0.5, 0.5, 0.5, 1, 0.5, 1, 2, 1, 1, 2];\nvar FireEffectiveness = [1, 1, 1, 1, 1, 0.5, 2, 1, 2, 0.5, 0.5, 2, 1, 1, 2, 0.5, 1, 1];\nvar WaterEffectiveness = [1, 1, 1, 1, 2, 2, 1, 1, 1, 2, 0.5, 0.5, 1, 1, 1, 0.5, 1, 1];\nvar GrassEffectiveness = [1, 1, 0.5, 0.5, 2, 2, 0.5, 1, 0.5, 0.5, 2, 0.5, 1, 1, 1, 0.5, 1, 1];\nvar ElectricEffectiveness = [1, 1, 2, 1, 0, 1, 1, 1, 1, 1, 2, 0.5, 0.5, 1, 1, 0.5, 1, 1];\nvar PsychicEffectiveness = [1, 2, 1, 2, 1, 1, 1, 1, 0.5, 1, 1, 1, 1, 0.5, 1, 1, 0, 1];\nvar IceEffectiveness = [1, 1, 2, 1, 2, 1, 1, 1, 0.5, 0.5, 0.5, 2, 1, 1, 0.5, 2, 1, 1];\nvar DragonEffectiveness = [1, 0.5, 1, 1, 1, 1, 1, 1, 0.5, 1, 1, 1, 1, 1, 1, 2, 1, 0];\nvar DarkEffectiveness = [1, 0.5, 1, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1, 2, 1, 1, 0.5, 0.5];\nvar FairyEffectiveness = [1, 2, 1, 0.5, 1, 1, 1, 1, 0.5, 0.5, 1, 1, 1, 1, 1, 2, 2, 1];\nvar MoveType = attacktype.value;\nvar DefT1 = enemytype1.value;\nvar DefT2 = enemytype2.value;\nvar DefT1Name = eval(\"typing[\"+DefT1+\"]\");\nvar typeindex1 = eval(MoveType+\"Effectiveness[\"+DefT1+\"]\");\nif (DefT2 !== \"None\") \n{\nvar typeindex2 = eval(MoveType+\"Effectiveness[\"+DefT2+\"]\");\nfinalvalue = typeindex1 * typeindex2;\nvar DefT2Name = eval(\"typing[\"+DefT2+\"]\");\n}\nif (DefT2 === \"None\") {\nfinalvalue = typeindex1;\nvar DefT2Name = \"None\";\n}\n\nlet results_html = `<h2>Test Results<h2>\nUnder normal circumstances, <span class=\"type ${MoveType.toLowerCase()}\"></span> should deal  x${finalvalue} damage to a <span class=\"type ${DefT1Name.toLowerCase()}\"></span> <span class=\"type ${DefT2Name.toLowerCase()}\"style=\"visibility:${DefT2Name == \"None\" ? \"hidden\" : \"visible\"}\"></span> Pokemon`\n\n\n\nreturn ChatMessage.create({content: results_html, whisper: ChatMessage.getWhisperRecipients(\"GM\")});\n};\nnew Dialog({\n  content,\n  title: \"Pokemon Type Calculator\",\n  buttons: {\n    go: {\n      callback,\n      label: \"Check type multiplier!\"\n    }\n  }\n}).render(true);","folder":null,"sort":0,"ownership":{"default":0,"Pc5KoEtD3AcIhK1c":3},"flags":{"combat-utility-belt":{"macroTrigger":""}},"_stats":{"systemId":"custom-system-builder","systemVersion":"2.1.0","coreVersion":"10.291","createdTime":1670906446520,"modifiedTime":1671670474476,"lastModifiedBy":"Pc5KoEtD3AcIhK1c"},"_id":"A2HLdBkV8UiIQc4M"}
{"name":"Battle Script","type":"script","author":"Pc5KoEtD3AcIhK1c","img":"worlds/prpg/Pokemon/item_icons/48px-Bag_Beast_Ball_SV_Sprite.png","scope":"global","command":"let targets = [] \ngame.user.targets.forEach(i => {\nlet name = i;\ntargets.push(name);\n})\nlet attackername = _token.document.name;\nlet targetname = targets[0].document.name;\nlet selectedtype = \"normal\"\nlet targetresist = eval('targets[0].document._actor.system.props.'+selectedtype+'resist');\nconst content = `\n<form>\n    <fieldset>\n        <legend id =\"legendname\">${attackername} attacking ${targetname}</legend>\n        <div>\n            <input type=\"checkbox\" id=\"STAB\" name=\"Effects\" value=\"STAB\">\n            <label for=\"STAB\">STAB</label>\n            <input type=\"checkbox\" id=\"Crit\" name=\"Effects\" value=\"Crit\">\n            <label for=\"Crit\">Crit</label>\n        </div>\n        <div>\n            <input type=\"number\" id=\"DResult\" name=\"Effects\" value=1>\n            <label for=\"DResult\">Damage Roll</label>\n        </div>\n        <div>\n            \n            <label> Attack Stat </label>\n            <select id=\"sml\" name=\"sml\">\n                <option value=\"ATK\">ATK</option>\n                <option value=\"SAtk\">SAtk</option>\n            </select>\n            <label> Attack Type</label>\n            <select id=\"atttype1\" name=\"atttype1\">\n                <option value=\"normal\">Normal</option>\n                <option value=\"fighting\">Fighting</option>\n                <option value=\"flying\">Flying</option>\n<option value=\"poison\">Poison</option>\n<option value=\"ground\">Ground</option>\n<option value=\"rock\">Rock</option>\n<option value=\"bug\">Bug</option>\n<option value=\"ghost\">Ghost</option>\n<option value=\"steel\">Steel</option>\n<option value=\"fire\">Fire</option>\n<option value=\"water\">Water</option>\n<option value=\"grass\">Grass</option>\n<option value=\"electric\">Electric</option>\n<option value=\"psychic\">Psychic</option>\n<option value=\"ice\">Ice</option>\n<option value=\"dragon\">Dragon</option>\n<option value=\"dark\">Dark</option>\n<option value=\"fairy\">Fairy</option>\n            </select>\n</div>\n<div>\n            <label> Multiplier </label>\n            <select id=\"multiplier\" name=\"multiplier\">\n                <option value=1>x1</option>\n                <option value=2>x2</option>\n                <option value=4>x4</option>\n<option value=0.5>1/2</option>\n<option value=0.25>1/4</option>\n\n\n\n            </select>\n        <label id=\"resistlabel\"> Detected Resistance:  x${targetresist} </label>\n</div>\n<div>\n            <input type=\"text\" id=\"movename\" name=\"Effects\">\n            <label for=\"movename\">Move Name:</label>\n</div>\n    </fieldset>\n</form>`;\nconst callback = async (html) => {\nfunction calculatePercent(percent, num){\n      return (percent / 100) * num;\n      }\nlet AttackerLevel = _token.actor.system.props.clevel; \nconst value = html[0].querySelector(\"#movename\").value;\nlet targets = [] \ngame.user.targets.forEach(i => {\nlet name = i;\ntargets.push(name);\n})\nlet defstat = 0\nlet atkstat = 0\nlet maxhp = Number(targets[0].document._actor.system.props.maxHP);\nlet targetname = targets[0].document.name;\nif(targets.length > 0 && sml.value == \"ATK\") {defstat = Number(targets[0].document._actor.system.props.DEF);\natkstat =Number(_token.actor.system.props.ATK); }\nif(targets.length > 0 && sml.value == \"SAtk\") {defstat = Number(targets[0].document._actor.system.props.SDEF);\natkstat =  Number(_token.actor.system.props.SAtk);}\nlet stab = html.find('[id=\"STAB\"]');\nlet stabcalc = AttackerLevel * 3;\nlet stabvalue = stab[0].checked ? stabcalc : 0        \nlet crit = html.find('[id=\"Crit\"]');\nlet critvalue = crit[0].checked ? 1.5 : 1        \n\n        let dresult = html.find('[id=\"DResult\"]');\nlet dresultvalue = Number(dresult[0].value);        \n        let mult = html.find('[name=\"multiplier\"]')[0].value;\nlet movedamage = atkstat + dresultvalue + stabvalue - defstat\nlet mindamage = Math.round(calculatePercent(5,maxhp));\nlet finaldamage = 0\nif (movedamage < mindamage) { movedamage = mindamage }\nif (movedamage * mult < mindamage) { finaldamage = mindamage * critvalue }\nelse { finaldamage = (movedamage * mult) * critvalue }\n\nlet results_html = `<h2>Attack Result<h2>\n${value} damages ${targetname} for: ${finaldamage}!`\n\nlet whisperresult = `Minimum: ${mindamage} using attack stat ${atkstat} against defending stat  ${defstat} with a dice value of ${dresultvalue} and STAB bonus of ${stabvalue}`\n\n\nChatMessage.create({\nuser: game.user._id,\nspeaker: ChatMessage.getSpeaker({token: actor}),\ncontent: results_html\n});\nreturn ChatMessage.create({content: whisperresult, whisper: ChatMessage.getWhisperRecipients(\"GM\")});\n};\nnew Dialog({\n  content,\n  title: \"Choose Attack options\",\n  buttons: {\n    go: {\n      callback,\n      label: \"Finalize Attack!\"\n    }\n  },\n  render: (html) => {\n    \n html[0].querySelector(\"#atttype1\").addEventListener(\"change\", async () => {\nlet targets = [] \ngame.user.targets.forEach(i => {\nlet name = i;\ntargets.push(name);\n})\nlet attackername = _token.document.name;\nlet targetname = targets[0].document.name;\nlet selectedtype = document.getElementById(\"atttype1\").value;\nlet targetresist = eval('targets[0].document._actor.system.props.'+selectedtype+'resist');\ndocument.getElementById(\"resistlabel\").innerHTML = \"Detected Resistance:  x\"+targetresist;\ndocument.getElementById(\"legendname\").innerHTML = attackername+\" attacking \"+targetname;\n});\n\nhtml[0].addEventListener(\"drop\", async (event) => {\n      const {uuid} = JSON.parse(event.dataTransfer.getData(\"text/plain\"));\n      const {link} = await fromUuid(uuid);\n      html[0].querySelector(\"#movename\").value = link;\n    });\n  }\n}).render(true);","folder":null,"sort":0,"ownership":{"default":0,"Pc5KoEtD3AcIhK1c":3},"flags":{"combat-utility-belt":{"macroTrigger":""}},"_stats":{"systemId":"custom-system-builder","systemVersion":"2.2.4","coreVersion":"10.291","createdTime":1670895160690,"modifiedTime":1678577543292,"lastModifiedBy":"Pc5KoEtD3AcIhK1c"},"_id":"tLwzis1kC22o9YLs"}
